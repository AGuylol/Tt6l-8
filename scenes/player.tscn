[gd_scene load_steps=57 format=3 uid="uid://c8tishbphs8e8"]

[ext_resource type="Texture2D" uid="uid://c6i4nsporlli8" path="res://arts/characters/player.png" id="1_bp6jc"]

[sub_resource type="GDScript" id="GDScript_g0g3h"]
script/source = "extends CharacterBody2D


var enemy_inattack_range = false
var enemy_attack_cooldown = true
var player_health = 100.0
var player_alive = false
var attacking = false

const speed = 100.0
var current_dir = \"none\"


func _ready():
	$player_animation.play(\"front_idle\")

func _physics_process(delta):
	player_movement(delta)
	player_attack(delta)
	enemy_attack()
	_on_attack_timeout()
	
	if player_health <= 0:
		player_alive = false 
		print(\"player died\") 
		self.queue_free()
	
func player_movement(delta):
	
	if Input.is_action_pressed(\"ui_right\"):
		current_dir= \"right\"
		player_animation(1)
		velocity.x= speed
		velocity.y=0
	elif Input.is_action_pressed(\"ui_left\"):
		current_dir= \"left\"
		player_animation(1)
		velocity.x =-speed
		velocity.y =0
	elif Input.is_action_pressed(\"ui_down\"):
		current_dir= \"down\"
		player_animation(1)
		velocity.x =0
		velocity.y =speed
	elif Input.is_action_pressed(\"ui_up\"):
		current_dir= \"up\"
		player_animation(1)
		velocity.x =0
		velocity.y =-speed
		
	else:
		player_animation(0)
		velocity.x =0
		velocity.y =0
	
	move_and_slide()
	
	
func player_animation(movement):
	var anim= $player_animation
	var dir=current_dir
	
	if dir == \"right\":
		anim.flip_h = false
		if movement == 1:
			anim.play(\"side_walk\")
		elif movement ==0:
			if attacking == false:
				anim.play(\"side_idle\")
			
	if dir == \"left\":
		anim.flip_h = true
		if movement == 1:
			anim.play(\"side_walk\")
		elif movement ==0:
			if attacking == false:
				anim.play(\"side_idle\")
			
	if dir == \"up\":
		anim.flip_h = true
		if movement == 1:
			anim.play(\"back_walk\")
		elif movement ==0:
			if attacking == false:
				anim.play(\"back_idle\")
			
	if dir == \"down\":
		anim.flip_h = true
		if movement == 1:
			anim.play(\"front_walk\")
		elif movement ==0:
			if attacking == false:
				anim.play(\"front_idle\")
				
				
func player_attack(delta):
	if Input.is_action_just_pressed(\"attack\"): 
		Global.player_current_attack = true
		attacking = true
		var dir = current_dir
		
		var anim = $player_animation
		
		if dir == \"right\":
			anim.flip_h = false
			anim.play(\"side_attack\")
			$attack.start()
			
		if dir == \"left\":
			anim.flip_h = true
			anim.play(\"side_attack\")
			$attack.start()
			
		if dir == \"up\":
			anim.flip_h = true
			anim.play(\"back_attack\")
			$attack.start()
		
		if dir == \"down\":
			anim.flip_h = true
			anim.play(\"front_attack\")
			$attack.start()
			
func _on_attack_timeout():
	$attack.stop()
	Global.player_current_attack = false
	attacking = false


func _on_playerhitbox_body_entered(body):
	if body.has_method(\"enemytest\"):
		enemy_inattack_range = true
		

func _on_playerhitbox_body_exited(body):
	if body.has_method(\"enemytest\"):
		enemy_inattack_range = false
		
func enemy_attack():
	if enemy_inattack_range and enemy_attack_cooldown == true:
		player_health = player_health - 20
		enemy_attack_cooldown = false
		$attack_cooldown.start()
		print(player_health)
		print(\"enemy attacked you\")
		

func _on_attack_cooldown_timeout():
	enemy_attack_cooldown = true





"

[sub_resource type="CapsuleShape2D" id="CapsuleShape2D_hitfu"]
radius = 3.0
height = 8.0

[sub_resource type="AtlasTexture" id="AtlasTexture_yskhf"]
atlas = ExtResource("1_bp6jc")
region = Rect2(0, 384, 48, 48)

[sub_resource type="AtlasTexture" id="AtlasTexture_q5lnx"]
atlas = ExtResource("1_bp6jc")
region = Rect2(48, 384, 48, 48)

[sub_resource type="AtlasTexture" id="AtlasTexture_4merl"]
atlas = ExtResource("1_bp6jc")
region = Rect2(96, 384, 48, 48)

[sub_resource type="AtlasTexture" id="AtlasTexture_lqhn8"]
atlas = ExtResource("1_bp6jc")
region = Rect2(144, 384, 48, 48)

[sub_resource type="AtlasTexture" id="AtlasTexture_j1u3e"]
atlas = ExtResource("1_bp6jc")
region = Rect2(0, 96, 48, 48)

[sub_resource type="AtlasTexture" id="AtlasTexture_usv8n"]
atlas = ExtResource("1_bp6jc")
region = Rect2(48, 96, 48, 48)

[sub_resource type="AtlasTexture" id="AtlasTexture_65gcw"]
atlas = ExtResource("1_bp6jc")
region = Rect2(96, 96, 48, 48)

[sub_resource type="AtlasTexture" id="AtlasTexture_o0rt7"]
atlas = ExtResource("1_bp6jc")
region = Rect2(144, 96, 48, 48)

[sub_resource type="AtlasTexture" id="AtlasTexture_qefwj"]
atlas = ExtResource("1_bp6jc")
region = Rect2(192, 96, 48, 48)

[sub_resource type="AtlasTexture" id="AtlasTexture_fv0ji"]
atlas = ExtResource("1_bp6jc")
region = Rect2(240, 96, 48, 48)

[sub_resource type="AtlasTexture" id="AtlasTexture_dipgu"]
atlas = ExtResource("1_bp6jc")
region = Rect2(0, 240, 48, 48)

[sub_resource type="AtlasTexture" id="AtlasTexture_duusc"]
atlas = ExtResource("1_bp6jc")
region = Rect2(48, 240, 48, 48)

[sub_resource type="AtlasTexture" id="AtlasTexture_k3p33"]
atlas = ExtResource("1_bp6jc")
region = Rect2(96, 240, 48, 48)

[sub_resource type="AtlasTexture" id="AtlasTexture_nxws0"]
atlas = ExtResource("1_bp6jc")
region = Rect2(144, 240, 48, 48)

[sub_resource type="AtlasTexture" id="AtlasTexture_eplqh"]
atlas = ExtResource("1_bp6jc")
region = Rect2(192, 240, 48, 48)

[sub_resource type="AtlasTexture" id="AtlasTexture_yrpgu"]
atlas = ExtResource("1_bp6jc")
region = Rect2(240, 240, 48, 48)

[sub_resource type="AtlasTexture" id="AtlasTexture_muj60"]
atlas = ExtResource("1_bp6jc")
region = Rect2(0, 432, 48, 48)

[sub_resource type="AtlasTexture" id="AtlasTexture_rwflq"]
atlas = ExtResource("1_bp6jc")
region = Rect2(48, 432, 48, 48)

[sub_resource type="AtlasTexture" id="AtlasTexture_3aufa"]
atlas = ExtResource("1_bp6jc")
region = Rect2(96, 432, 48, 48)

[sub_resource type="AtlasTexture" id="AtlasTexture_1np6u"]
atlas = ExtResource("1_bp6jc")
region = Rect2(0, 288, 48, 48)

[sub_resource type="AtlasTexture" id="AtlasTexture_b5rg8"]
atlas = ExtResource("1_bp6jc")
region = Rect2(48, 288, 48, 48)

[sub_resource type="AtlasTexture" id="AtlasTexture_g0aps"]
atlas = ExtResource("1_bp6jc")
region = Rect2(96, 288, 48, 48)

[sub_resource type="AtlasTexture" id="AtlasTexture_38iqm"]
atlas = ExtResource("1_bp6jc")
region = Rect2(144, 288, 48, 48)

[sub_resource type="AtlasTexture" id="AtlasTexture_tg8kn"]
atlas = ExtResource("1_bp6jc")
region = Rect2(0, 0, 48, 48)

[sub_resource type="AtlasTexture" id="AtlasTexture_tebmj"]
atlas = ExtResource("1_bp6jc")
region = Rect2(48, 0, 48, 48)

[sub_resource type="AtlasTexture" id="AtlasTexture_2ayfo"]
atlas = ExtResource("1_bp6jc")
region = Rect2(96, 0, 48, 48)

[sub_resource type="AtlasTexture" id="AtlasTexture_faduo"]
atlas = ExtResource("1_bp6jc")
region = Rect2(144, 0, 48, 48)

[sub_resource type="AtlasTexture" id="AtlasTexture_de3mb"]
atlas = ExtResource("1_bp6jc")
region = Rect2(192, 0, 48, 48)

[sub_resource type="AtlasTexture" id="AtlasTexture_hkrwb"]
atlas = ExtResource("1_bp6jc")
region = Rect2(240, 0, 48, 48)

[sub_resource type="AtlasTexture" id="AtlasTexture_xvwxe"]
atlas = ExtResource("1_bp6jc")
region = Rect2(0, 144, 48, 48)

[sub_resource type="AtlasTexture" id="AtlasTexture_xc5nn"]
atlas = ExtResource("1_bp6jc")
region = Rect2(48, 144, 48, 48)

[sub_resource type="AtlasTexture" id="AtlasTexture_jgi80"]
atlas = ExtResource("1_bp6jc")
region = Rect2(96, 144, 48, 48)

[sub_resource type="AtlasTexture" id="AtlasTexture_oshxk"]
atlas = ExtResource("1_bp6jc")
region = Rect2(144, 144, 48, 48)

[sub_resource type="AtlasTexture" id="AtlasTexture_3i2tf"]
atlas = ExtResource("1_bp6jc")
region = Rect2(192, 144, 48, 48)

[sub_resource type="AtlasTexture" id="AtlasTexture_gmt22"]
atlas = ExtResource("1_bp6jc")
region = Rect2(240, 144, 48, 48)

[sub_resource type="AtlasTexture" id="AtlasTexture_78u3o"]
atlas = ExtResource("1_bp6jc")
region = Rect2(0, 336, 48, 48)

[sub_resource type="AtlasTexture" id="AtlasTexture_u5ugj"]
atlas = ExtResource("1_bp6jc")
region = Rect2(48, 336, 48, 48)

[sub_resource type="AtlasTexture" id="AtlasTexture_lebqp"]
atlas = ExtResource("1_bp6jc")
region = Rect2(96, 336, 48, 48)

[sub_resource type="AtlasTexture" id="AtlasTexture_uma4p"]
atlas = ExtResource("1_bp6jc")
region = Rect2(144, 336, 48, 48)

[sub_resource type="AtlasTexture" id="AtlasTexture_58ois"]
atlas = ExtResource("1_bp6jc")
region = Rect2(0, 48, 48, 48)

[sub_resource type="AtlasTexture" id="AtlasTexture_8s7nx"]
atlas = ExtResource("1_bp6jc")
region = Rect2(48, 48, 48, 48)

[sub_resource type="AtlasTexture" id="AtlasTexture_4ij4d"]
atlas = ExtResource("1_bp6jc")
region = Rect2(96, 48, 48, 48)

[sub_resource type="AtlasTexture" id="AtlasTexture_4foex"]
atlas = ExtResource("1_bp6jc")
region = Rect2(144, 48, 48, 48)

[sub_resource type="AtlasTexture" id="AtlasTexture_i3a5u"]
atlas = ExtResource("1_bp6jc")
region = Rect2(192, 48, 48, 48)

[sub_resource type="AtlasTexture" id="AtlasTexture_m5blt"]
atlas = ExtResource("1_bp6jc")
region = Rect2(240, 48, 48, 48)

[sub_resource type="AtlasTexture" id="AtlasTexture_mhh4r"]
atlas = ExtResource("1_bp6jc")
region = Rect2(0, 192, 48, 48)

[sub_resource type="AtlasTexture" id="AtlasTexture_laev4"]
atlas = ExtResource("1_bp6jc")
region = Rect2(48, 192, 48, 48)

[sub_resource type="AtlasTexture" id="AtlasTexture_uc3lc"]
atlas = ExtResource("1_bp6jc")
region = Rect2(96, 192, 48, 48)

[sub_resource type="AtlasTexture" id="AtlasTexture_jqp8u"]
atlas = ExtResource("1_bp6jc")
region = Rect2(144, 192, 48, 48)

[sub_resource type="AtlasTexture" id="AtlasTexture_gu3sl"]
atlas = ExtResource("1_bp6jc")
region = Rect2(192, 192, 48, 48)

[sub_resource type="AtlasTexture" id="AtlasTexture_lgb43"]
atlas = ExtResource("1_bp6jc")
region = Rect2(240, 192, 48, 48)

[sub_resource type="SpriteFrames" id="SpriteFrames_wetq0"]
animations = [{
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_yskhf")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_q5lnx")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_4merl")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_lqhn8")
}],
"loop": true,
"name": &"back_attack",
"speed": 5.0
}, {
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_j1u3e")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_usv8n")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_65gcw")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_o0rt7")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_qefwj")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_fv0ji")
}],
"loop": true,
"name": &"back_idle",
"speed": 5.0
}, {
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_dipgu")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_duusc")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_k3p33")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_nxws0")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_eplqh")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_yrpgu")
}],
"loop": true,
"name": &"back_walk",
"speed": 5.0
}, {
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_muj60")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_rwflq")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_3aufa")
}],
"loop": true,
"name": &"death",
"speed": 5.0
}, {
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_1np6u")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_b5rg8")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_g0aps")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_38iqm")
}],
"loop": true,
"name": &"front_attack",
"speed": 5.0
}, {
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_tg8kn")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_tebmj")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_2ayfo")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_faduo")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_de3mb")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_hkrwb")
}],
"loop": true,
"name": &"front_idle",
"speed": 5.0
}, {
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_xvwxe")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_xc5nn")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_jgi80")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_oshxk")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_3i2tf")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_gmt22")
}],
"loop": true,
"name": &"front_walk",
"speed": 5.0
}, {
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_78u3o")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_u5ugj")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_lebqp")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_uma4p")
}],
"loop": true,
"name": &"side_attack",
"speed": 5.0
}, {
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_58ois")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_8s7nx")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_4ij4d")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_4foex")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_i3a5u")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_m5blt")
}],
"loop": true,
"name": &"side_idle",
"speed": 5.0
}, {
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_mhh4r")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_laev4")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_uc3lc")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_jqp8u")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_gu3sl")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_lgb43")
}],
"loop": true,
"name": &"side_walk",
"speed": 5.0
}]

[sub_resource type="CapsuleShape2D" id="CapsuleShape2D_1q7mt"]
radius = 9.0
height = 26.0

[node name="player" type="CharacterBody2D"]
light_mask = 3
visibility_layer = 3
collision_layer = 3
collision_mask = 3
script = SubResource("GDScript_g0g3h")

[node name="CollisionShape2D" type="CollisionShape2D" parent="."]
light_mask = 3
visibility_layer = 3
y_sort_enabled = true
position = Vector2(0, 12)
shape = SubResource("CapsuleShape2D_hitfu")

[node name="player_animation" type="AnimatedSprite2D" parent="."]
sprite_frames = SubResource("SpriteFrames_wetq0")
animation = &"back_attack"

[node name="Camera2D" type="Camera2D" parent="."]
zoom = Vector2(4, 4)

[node name="playerhitbox" type="Area2D" parent="."]

[node name="CollisionShape2D" type="CollisionShape2D" parent="playerhitbox"]
position = Vector2(0, 7)
shape = SubResource("CapsuleShape2D_1q7mt")

[node name="attack_cooldown" type="Timer" parent="."]

[node name="attack" type="Timer" parent="."]
wait_time = 5.263

[connection signal="body_entered" from="playerhitbox" to="." method="_on_playerhitbox_body_entered"]
[connection signal="body_exited" from="playerhitbox" to="." method="_on_playerhitbox_body_exited"]
[connection signal="timeout" from="attack_cooldown" to="." method="_on_attack_cooldown_timeout"]
[connection signal="timeout" from="attack" to="." method="_on_attack_timeout"]
